<!DOCTYPE html>
<html>

<head>
    <script src="codebase.js"></script>
    <meta charset="UTF-8">
    <title>Kazán-Gólya Fűtés: időzített kérés</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>

<body>
    <h1>időzített kérés</h1>
    <div class="container">
        <iframe
            id = "formIframe"
            src="https://docs.google.com/forms/d/e/1FAIpQLSfQAF-GPitY0SrgNjkhmtnC-8a9oBy1MNvCMDuwykw0vIcz4Q/viewform?embedded=true"
            width="640" height="1200" frameborder="0" marginheight="0" marginwidth="0">form tölt...</iframe>
        <ul>
            <li><a href="index.html">> kezdőoldal</a></li>
            <li><a href="dashboard.html">> rendszerállapot</a></li>
        </ul>
    </div>
    <script>
        function fetchSubmissionState() {
            fetchJSONEndpoint('https://raw.githubusercontent.com/markusbenjamin/kazanfutes/refs/heads/main/utils/settings.json').then(data => {
                heatingControlConfig = data;
                fetchJSONEndpoint(heatingControlConfig["firebase_url"] + "/update.json").then(data => {
                    secondsSinceLastUpdate =  timePassedSince(dateFromTimestamp(data['override_rooms']['last_update_timestamp']),granularity = 'seconds')
                    console.log(secondsSinceLastUpdate)
                    if(secondsSinceLastUpdate<1){
                        document.getElementById("formIframe").style.display = "none";
                    }
                });
            });
        }

        fetchSubmissionState();
        setInterval(fetchSubmissionState, 900);
    </script>
</body>

</html>